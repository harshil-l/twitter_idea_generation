#!/usr/bin/env node
/**
 * SaaS Code Generator
 * Generates a complete full-stack SaaS application
 */

const fs = require('fs');
const path = require('path');

class SaaSCodeGenerator {
  constructor(saasData) {
    this.saas = saasData;
    this.projectName = saasData.name.toLowerCase().replace(/\s+/g, '-');
    this.outputDir = `./generated-clones/${this.projectName}`;
  }

  async generateClone() {
    console.log(`üöÄ Generating ${this.saas.name} clone...`);
    
    try {
      // Create project structure
      await this.createProjectStructure();
      
      // Generate frontend (Next.js)
      await this.generateFrontend();
      
      // Generate backend (Node.js/Express)
      await this.generateBackend();
      
      // Generate documentation
      await this.generateDocumentation();
      
      console.log(`‚úÖ Clone generated successfully at: ${this.outputDir}`);
      console.log(`üîß Next steps:`);
      console.log(`   cd ${this.outputDir}`);
      console.log(`   cd frontend && npm install && npm run dev`);
      
      return this.outputDir;
      
    } catch (error) {
      console.error('‚ùå Generation failed:', error.message);
      throw error;
    }
  }

  async createProjectStructure() {
    console.log('üìÅ Creating project structure...');
    
    const dirs = [
      this.outputDir,
      `${this.outputDir}/frontend`,
      `${this.outputDir}/frontend/pages`,
      `${this.outputDir}/frontend/styles`,
      `${this.outputDir}/backend`
    ];

    dirs.forEach(dir => {
      if (!fs.existsSync(dir)) {
        fs.mkdirSync(dir, { recursive: true });
      }
    });
  }

  async generateFrontend() {
    console.log('‚öõÔ∏è Generating Next.js frontend...');
    
    // Package.json
    const packageJson = {
      name: `${this.projectName}-frontend`,
      version: "1.0.0",
      private: true,
      scripts: {
        dev: "next dev",
        build: "next build",
        start: "next start"
      },
      dependencies: {
        "next": "14.0.0",
        "react": "^18.0.0",
        "react-dom": "^18.0.0",
        "tailwindcss": "^3.3.0",
        "autoprefixer": "^10.4.0",
        "postcss": "^8.4.0"
      }
    };

    fs.writeFileSync(
      `${this.outputDir}/frontend/package.json`,
      JSON.stringify(packageJson, null, 2)
    );

    // Generate main page
    const homePage = `export default function Home() {
  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white">
      <header className="container mx-auto px-4 py-6">
        <nav className="flex justify-between items-center">
          <div className="text-2xl font-bold text-blue-600">
            ${this.saas.name}
          </div>
          <div className="space-x-4">
            <button className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
              Get Started
            </button>
          </div>
        </nav>
      </header>

      <main className="container mx-auto px-4 py-20">
        <div className="text-center max-w-4xl mx-auto">
          <h1 className="text-5xl font-bold text-gray-900 mb-6">
            ${this.saas.description || this.saas.name}
          </h1>
          <p className="text-xl text-gray-600 mb-8">
            Built with modern technology for maximum efficiency
          </p>
          
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-${Math.min(this.saas.features.length, 4)} gap-8 mt-20">
            ${this.saas.features.map(feature => `
            <div className="text-center p-6 bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow">
              <div className="w-12 h-12 bg-blue-100 rounded-lg mx-auto mb-4 flex items-center justify-center">
                <span className="text-blue-600 font-bold">‚úì</span>
              </div>
              <h3 className="font-semibold text-lg mb-2">${feature}</h3>
              <p className="text-gray-600">${feature} functionality ready to use</p>
            </div>
            `).join('')}
          </div>

          <div className="mt-16 p-8 bg-gray-50 rounded-lg">
            <h2 className="text-2xl font-bold mb-4">Ready to Launch! üöÄ</h2>
            <p className="text-gray-600 mb-6">Your ${this.saas.name} clone is ready for customization</p>
            <div className="flex justify-center gap-4">
              <button className="bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700">
                Start Building
              </button>
              <button className="bg-gray-200 text-gray-800 px-6 py-3 rounded-md hover:bg-gray-300">
                View Documentation
              </button>
            </div>
          </div>
        </div>
      </main>

      <footer className="bg-gray-900 text-white py-12 mt-20">
        <div className="container mx-auto px-4 text-center">
          <p>¬© 2026 ${this.saas.name} Clone. Built with #dayXofkillingSaaS</p>
          <p className="text-gray-400 mt-2">Generated by SaaS Automation System</p>
        </div>
      </footer>
    </div>
  )
}`;

    fs.writeFileSync(`${this.outputDir}/frontend/pages/index.js`, homePage);

    // Tailwind CSS config
    const tailwindConfig = `/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx}',
    './components/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}`;

    fs.writeFileSync(`${this.outputDir}/frontend/tailwind.config.js`, tailwindConfig);

    // PostCSS config
    const postcssConfig = `module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}`;

    fs.writeFileSync(`${this.outputDir}/frontend/postcss.config.js`, postcssConfig);

    // CSS
    const globalCss = `@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  .btn-primary {
    @apply bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors;
  }
}`;

    fs.writeFileSync(`${this.outputDir}/frontend/styles/globals.css`, globalCss);
  }

  async generateBackend() {
    console.log('üîß Generating Node.js backend...');
    
    // Package.json for backend
    const packageJson = {
      name: `${this.projectName}-backend`,
      version: "1.0.0",
      description: `Backend API for ${this.saas.name}`,
      main: "server.js",
      scripts: {
        start: "node server.js",
        dev: "nodemon server.js"
      },
      dependencies: {
        "express": "^4.18.0",
        "cors": "^2.8.5",
        "dotenv": "^16.3.0",
        "helmet": "^7.0.0"
      },
      devDependencies: {
        "nodemon": "^3.0.0"
      }
    };

    fs.writeFileSync(
      `${this.outputDir}/backend/package.json`,
      JSON.stringify(packageJson, null, 2)
    );

    // Main server file
    const serverJs = `const express = require('express');
const cors = require('cors');
const helmet = require('helmet');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 5000;

// Middleware
app.use(helmet());
app.use(cors());
app.use(express.json());

// Health check
app.get('/api/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    service: '${this.saas.name} API',
    version: '1.0.0',
    timestamp: new Date().toISOString(),
    features: [${this.saas.features.map(f => `'${f}'`).join(', ')}]
  });
});

// Feature endpoints
${this.saas.features.map(feature => {
  const endpoint = feature.toLowerCase().replace(/\s+/g, '');
  return `
// ${feature} API
app.get('/api/${endpoint}', (req, res) => {
  res.json({ 
    feature: '${feature}',
    status: 'Available',
    description: '${feature} functionality endpoint',
    endpoints: [
      'GET /api/${endpoint} - Get ${feature.toLowerCase()} data',
      'POST /api/${endpoint} - Create new ${feature.toLowerCase()}',
      'PUT /api/${endpoint}/:id - Update ${feature.toLowerCase()}',
      'DELETE /api/${endpoint}/:id - Delete ${feature.toLowerCase()}'
    ]
  });
});

app.post('/api/${endpoint}', (req, res) => {
  res.status(201).json({
    message: '${feature} created successfully',
    data: req.body,
    id: Math.floor(Math.random() * 1000)
  });
});`;
}).join('')}

// Demo data endpoint
app.get('/api/demo-data', (req, res) => {
  res.json({
    message: 'Welcome to ${this.saas.name} API!',
    features: [${this.saas.features.map(f => `'${f}'`).join(', ')}],
    sampleData: {
      users: 1250,
      projects: 89,
      active: true,
      category: '${this.saas.category || 'productivity'}',
      version: '1.0.0'
    },
    endpoints: {
      health: '/api/health',
      demo: '/api/demo-data',
      features: [${this.saas.features.map(f => `'/api/${f.toLowerCase().replace(/\s+/g, '')}'`).join(', ')}]
    }
  });
});

// 404 handler
app.use('*', (req, res) => {
  res.status(404).json({ 
    error: 'Route not found',
    available: '/api/health, /api/demo-data'
  });
});

// Error handler
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ 
    error: 'Something went wrong!',
    message: err.message 
  });
});

app.listen(PORT, () => {
  console.log(\`üöÄ ${this.saas.name} API running on port \${PORT}\`);
  console.log(\`üìä Features: ${this.saas.features.join(', ')}\`);
  console.log(\`üîó Health check: http://localhost:\${PORT}/api/health\`);
});`;

    fs.writeFileSync(`${this.outputDir}/backend/server.js`, serverJs);

    // Environment variables template
    const envTemplate = `# ${this.saas.name} Backend Configuration
PORT=5000
NODE_ENV=development

# Add your API keys and configuration here
# DATABASE_URL=your_database_connection_string
# JWT_SECRET=your_jwt_secret_key
# API_KEY=your_api_key`;

    fs.writeFileSync(`${this.outputDir}/backend/.env.example`, envTemplate);
  }

  async generateDocumentation() {
    console.log('üìö Generating documentation...');
    
    const readme = `# ${this.saas.name} Clone

> ${this.saas.description || 'A modern SaaS application clone'}

## üöÄ Features

${this.saas.features.map(feature => `- ‚úÖ **${feature}** - Ready for implementation`).join('\n')}

## üõ†Ô∏è Tech Stack

- **Frontend**: Next.js 14, React 18, Tailwind CSS
- **Backend**: Node.js, Express.js
- **Deployment**: Vercel (frontend) + Railway (backend)

## üèÉ‚Äç‚ôÇÔ∏è Quick Start

### 1. Frontend Setup
\`\`\`bash
cd frontend
npm install
npm run dev
# Visit http://localhost:3000
\`\`\`

### 2. Backend Setup  
\`\`\`bash
cd backend
npm install
cp .env.example .env
npm run dev
# API running on http://localhost:5000
\`\`\`

### 3. Test the API
\`\`\`bash
curl http://localhost:5000/api/health
curl http://localhost:5000/api/demo-data
\`\`\`

## üìä Project Stats

- **Generated on**: ${new Date().toLocaleDateString()}
- **Category**: ${this.saas.category || 'SaaS'}
- **Difficulty**: ${this.saas.cloneDifficulty || 'Medium'}
- **Features**: ${this.saas.features.length}
- **Build Time**: ~${this.saas.features.length * 2} hours

## üîß API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| \`/api/health\` | GET | Health check |
| \`/api/demo-data\` | GET | Demo data & info |
${this.saas.features.map(feature => {
  const endpoint = feature.toLowerCase().replace(/\s+/g, '');
  return `| \`/api/${endpoint}\` | GET/POST | ${feature} operations |`;
}).join('\n')}

## üéØ Development Roadmap

- [x] ‚úÖ Project structure
- [x] ‚úÖ Basic frontend with Tailwind
- [x] ‚úÖ Express.js backend with CORS
- [x] ‚úÖ API endpoints for all features
- [ ] üîÑ Database integration
- [ ] üîÑ User authentication  
- [ ] üîÑ Payment processing
- [ ] üîÑ Advanced features
- [ ] üîÑ Mobile responsive design
- [ ] üîÑ Testing & optimization

## üê¶ Twitter Campaign

This project was generated as part of the **#dayXofkillingSaaS** campaign.

### Tweet Templates:

**Day 1 (Launch):**
\`\`\`
üöÄ Just built ${this.saas.name} clone in record time!

‚úÖ ${this.saas.features.slice(0, 2).join('\n‚úÖ ')}
‚úÖ Full-stack (Next.js + Node.js)
‚úÖ Ready to deploy

#day1ofkillingSaaS #buildinpublic #saas #nextjs

Time to build: ~${this.saas.features.length * 2} hours
\`\`\`

**Progress Update:**
\`\`\`
üí™ ${this.saas.name} clone progress:

Frontend: ‚úÖ 
Backend: ‚úÖ
Features: ${this.saas.features.length}/X
Deployment: üîÑ

Next up: User auth + payments

#day2ofkillingSaaS #buildinpublic
\`\`\`

**Launch Tweet:**
\`\`\`
üéâ ${this.saas.name} clone is LIVE!

üîó [your-deployment-url]

Built in X days with:
${this.saas.features.slice(0, 3).map(f => `‚Ä¢ ${f}`).join('\n')}

Free & open source üíô

#dayXofkillingSaaS #launched #opensource
\`\`\`

## üìù Customization Guide

### Adding New Features
1. Add API endpoint in \`backend/server.js\`
2. Create frontend component in \`frontend/pages/\`
3. Update this README
4. Tweet about it! üê¶

### Styling Changes
- Edit \`frontend/styles/globals.css\`
- Modify \`tailwind.config.js\` for custom colors
- Update components in \`frontend/pages/\`

### Deployment

**Frontend (Vercel):**
\`\`\`bash
cd frontend
npm run build
npx vercel --prod
\`\`\`

**Backend (Railway):**
\`\`\`bash
cd backend
# Push to GitHub
# Connect Railway to your repo
\`\`\`

## ü§ù Contributing

1. Fork this repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request
5. Tweet about your contribution!

## üìÑ License

MIT License - Free to use for personal and commercial projects!

---

**Built with ‚ù§Ô∏è by SaaS Automation System**

*This clone was automatically generated to demonstrate rapid SaaS development. Customize it, deploy it, and make it your own!*

### üèÜ Challenge: Can you add a new feature and deploy it in under 2 hours?

**Share your results with #dayXofkillingSaaS**`;

    fs.writeFileSync(`${this.outputDir}/README.md`, readme);

    // Create deployment guide
    const deployGuide = `# Deployment Guide for ${this.saas.name}

## üöÄ Quick Deploy (Recommended)

### Frontend ‚Üí Vercel
1. Push code to GitHub
2. Connect Vercel to your repo
3. Deploy automatically ‚ú®

### Backend ‚Üí Railway  
1. Push backend to GitHub
2. Create Railway project
3. Connect repo & deploy üöÄ

## üìã Pre-deployment Checklist

- [ ] Test locally (npm run dev)
- [ ] Environment variables configured
- [ ] Database connected (if applicable)
- [ ] Error handling implemented
- [ ] Security headers added
- [ ] CORS configured properly

## üîó Post-deployment

1. **Test your live app**
2. **Update README with live URLs** 
3. **Tweet your success! üê¶**
   \`\`\`
   üéâ ${this.saas.name} is now LIVE!
   
   üîó [your-url-here]
   
   Built & deployed in X hours
   #dayXofkillingSaaS #deployed
   \`\`\`

Happy deploying! üöÄ`;

    fs.writeFileSync(`${this.outputDir}/DEPLOYMENT.md`, deployGuide);
  }
}

module.exports = SaaSCodeGenerator;

// Run if called directly
if (require.main === module) {
  const sampleSaaS = {
    name: "Quick QR Generator", 
    description: "Generate QR codes for any content instantly",
    features: ["QR generation", "Custom designs", "Analytics", "Bulk creation"],
    category: "utility",
    cloneDifficulty: "easy"
  };

  const generator = new SaaSCodeGenerator(sampleSaaS);
  generator.generateClone()
    .then(outputDir => {
      console.log(`üéâ Success! Check out your new SaaS clone at: ${outputDir}`);
    })
    .catch(error => {
      console.error('‚ùå Generation failed:', error);
    });
}
